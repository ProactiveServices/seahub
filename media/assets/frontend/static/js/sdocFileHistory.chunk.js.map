{"version":3,"sources":["components/common/go-back/index.js","models/file-history.js","pages/sdoc-file-history/history-version.js","components/common/switch/index.js","pages/sdoc-file-history/side-panel.js","pages/sdoc-file-history/index.js"],"names":["GoBack","onBackClick","event","preventDefault","window","history","back","className","onClick","this","Component","moment","locale","app","config","lang","FileHistory","object","commitId","commit_id","undefined","ctime","format","creatorName","creator_name","size","revRenamedOldPath","rev_renamed_old_path","revFileId","rev_file_id","path","description","HistoryVersion","props","onMouseEnter","currentVersion","historyVersion","setState","isShowOperationIcon","onMouseLeave","onToggleClick","e","isMenuShow","state","onSelectHistoryVersion","onRestore","onItemDownload","isHighlightItem","url","URLDecorator","getUrl","type","filePath","objID","Dropdown","isOpen","toggle","DropdownToggle","tag","alt","gettext","DropdownMenu","index","DropdownItem","onItemRestore","href","onItemDownLoad","React","Switch","onChange","checked","placeholder","disabled","classnames","name","SidePanel","init","hasMore","nextCommit","oldFilePath","listHistoryVersions","repoID","commit","callback","seafileAPI","listOldFileHistoryRecords","then","res","historyData","data","updateHistoryVersions","isLoading","errorMessage","catch","error","Utils","getErrorMsg","onScrollHandler","clientHeight","target","scrollHeight","scrollTop","loadMore","currentFilePath","historyRepoID","restoreVersion","editUtilities","revertFile","success","historyVersions","toaster","danger","isShowChanges","historyVersionIndex","findIndex","item","renderHistoryVersions","length","map","onShowChanges","lastVersion","lastHistoryVersion","result","dataCount","next_start_commit","addedHistoryVersions","onScroll","serviceURL","avatarURL","siteRoot","pageOptions","username","fileHistory","fileName","docUuid","assetsUrl","seafile","docPath","docName","isOpenSocket","serviceUrl","SdocFileHistory","getFileRevision","getFileContent","currentVersionContent","lastVersionContent","setContent","changes","currentDiffIndex","localStorage","setItem","setDiffCount","diff","value","jumpToElement","change","changeElement","document","querySelectorAll","historyContentRef","offsetTop","lastChange","nextChange","getItem","changesCount","isShowChangesTips","id","UncontrolledTooltip","placement","ref","currentContent","lastContent","didMountCallback","ReactDom","render","getElementById"],"mappings":"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","file":"static/js/sdocFileHistory.chunk.js","sourcesContent":["import React, { Component } from 'react';\n\nimport './index.css';\n\nclass GoBack extends Component {\n\n  onBackClick = (event) => {\n    event.preventDefault();\n    window.history.back();\n  }\n\n  render() {\n    return (\n      <div className=\"go-back\" onClick={this.onBackClick}>\n        <span className=\"fas fa-chevron-left\"></span>\n      </div>\n    );\n  }\n}\n\nexport default GoBack;\n","import moment from 'moment';\nmoment.locale(window.app.config.lang);\n\nexport default class FileHistory {\n\n  constructor(object) {\n    this.commitId = object.commit_id || undefined;\n    this.ctime = object.ctime ? moment(object.ctime).format('YYYY-MM-DD HH:mm') : '';\n    this.creatorName = object.creator_name || '';\n    this.size = object.size || 0;\n    this.revRenamedOldPath = object.rev_renamed_old_path || '';\n    this.revFileId = object.rev_file_id || '';\n    this.path = object.path || '';\n    this.description = object.description || '';\n  }\n\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Dropdown, DropdownToggle, DropdownMenu, DropdownItem} from 'reactstrap';\nimport { gettext, filePath } from '../../utils/constants';\nimport URLDecorator from '../../utils/url-decorator';\n\nimport '../../css/history-record-item.css';\n\nclass HistoryVersion extends React.Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowOperationIcon: false,\n      isMenuShow: false,\n    };\n  }\n\n  onMouseEnter = () => {\n    const { currentVersion, historyVersion } = this.props;\n    if (currentVersion.commitId === historyVersion.commitId) return;\n    this.setState({ isShowOperationIcon: true });\n  }\n\n  onMouseLeave = () => {\n    const { currentVersion, historyVersion } = this.props;\n    if (currentVersion.commitId === historyVersion.commitId) return;\n    this.setState({ isShowOperationIcon: false });\n  }\n\n  onToggleClick = (e) => {\n    this.setState({ isMenuShow: !this.state.isMenuShow });\n  }\n\n  onClick = () => {\n    this.setState({ isShowOperationIcon: false });\n    const { currentVersion, historyVersion } = this.props;\n    if (currentVersion.commitId === historyVersion.commitId) return;\n    this.props.onSelectHistoryVersion(historyVersion);\n  }\n\n  onRestore = () => {\n    const { historyVersion } = this.props;\n    this.props.onRestore(historyVersion);\n  }\n\n  onItemDownload = () => {\n    // nothing todo\n  }\n\n  render() {\n    const { currentVersion, historyVersion } = this.props;\n    if (!currentVersion || !historyVersion) return null;\n    const { ctime, commitId, creatorName, revFileId } = historyVersion;\n    const isHighlightItem = commitId === currentVersion.commitId;\n    const url = URLDecorator.getUrl({ type: 'download_historic_file', filePath: filePath, objID: revFileId });\n    return (\n      <li\n        className={`history-list-item ${isHighlightItem ? 'item-active' : ''}`}\n        onMouseEnter={this.onMouseEnter}\n        onMouseLeave={this.onMouseLeave}\n        onClick={this.onClick}\n      >\n        <div className=\"history-info\">\n          <div className=\"time\">{ctime}</div>\n          <div className=\"owner\">\n            <span className=\"squire-icon\"></span>\n            <span>{creatorName}</span>\n          </div>\n        </div>\n        <div className=\"history-operation\">\n          <Dropdown isOpen={this.state.isMenuShow} toggle={this.onToggleClick}>\n            <DropdownToggle\n              tag='a'\n              className={`fas fa-ellipsis-v ${(this.state.isShowOperationIcon || isHighlightItem) ? '' : 'invisible'}`}\n              data-toggle=\"dropdown\"\n              aria-expanded={this.state.isMenuShow}\n              alt={gettext('More Operations')}\n            />\n            <DropdownMenu>\n              {(this.props.index !== 0) && <DropdownItem onClick={this.onItemRestore}>{gettext('Restore')}</DropdownItem>}\n              <DropdownItem tag='a' href={url} onClick={this.onItemDownLoad}>{gettext('Download')}</DropdownItem>\n            </DropdownMenu>\n          </Dropdown>\n        </div>\n      </li>\n    );\n  }\n}\n\nHistoryVersion.propTypes = {\n  index: PropTypes.number,\n  currentVersion: PropTypes.object.isRequired,\n  historyVersion: PropTypes.object,\n  onSelectHistoryVersion: PropTypes.func.isRequired,\n  onRestore: PropTypes.func.isRequired,\n};\n\nexport default HistoryVersion;\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\n\nimport '../../../css/switch.css';\n\nfunction Switch(props) {\n  const { onChange, checked, placeholder, disabled, className, size } = props;\n\n  return(\n    <div className={classnames('seahub-switch position-relative', className, size)}>\n      <label className=\"custom-switch\">\n        <input\n          className=\"custom-switch-input\"\n          type=\"checkbox\"\n          checked={checked}\n          onChange={onChange}\n          name=\"custom-switch-checkbox\"\n          disabled={disabled}\n        />\n        <span className=\"custom-switch-description text-truncate\">{placeholder}</span>\n        <span className=\"custom-switch-indicator\"></span>\n      </label>\n    </div>\n  );\n}\n\nSwitch.propTypes = {\n  checked: PropTypes.bool,\n  disabled: PropTypes.bool,\n  placeholder: PropTypes.oneOfType([PropTypes.string, PropTypes.node]),\n  className: PropTypes.string,\n  size: PropTypes.oneOf(['large', 'small', undefined]),\n  onChange: PropTypes.func.isRequired,\n};\n\nexport default Switch;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport Loading from '../../components/loading';\nimport { gettext, filePath, historyRepoID } from '../../utils/constants';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport FileHistory from '../../models/file-history';\nimport { Utils } from '../../utils/utils';\nimport editUtilities from '../../utils/editor-utilities';\nimport toaster from '../../components/toast';\nimport HistoryVersion from './history-version';\nimport Switch from '../../components/common/switch';\n\nclass SidePanel extends Component {\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      historyVersions: [],\n      errorMessage: '',\n    };\n    this.init();\n  }\n\n  componentDidMount() {\n    this.listHistoryVersions(historyRepoID, filePath, this.nextCommit, (historyVersion, lastHistoryVersion) => {\n      this.props.onSelectHistoryVersion(historyVersion, lastHistoryVersion);\n    });\n  }\n\n  init = () => {\n    this.hasMore = true;\n    this.nextCommit = '';\n    this.filePath = '';\n    this.oldFilePath = '';\n  }\n\n  listHistoryVersions = (repoID, filePath, commit, callback) => {\n    seafileAPI.listOldFileHistoryRecords(repoID, filePath, commit).then((res) => {\n      let historyData = res.data;\n      if (!historyData) {\n        this.setState({ isLoading: false, errorMessage: 'There is an error in server.' });\n        return;\n      }\n      this.updateHistoryVersions(historyData, callback);\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      this.setState({ isLoading: false, errorMessage: errorMessage });\n    });\n  }\n\n  updateHistoryVersions(result, callback) {\n    const dataCount = result.data ? result.data.length : 0;\n    this.nextCommit = result.next_start_commit || '';\n    if (dataCount) {\n      const addedHistoryVersions = result.data.map(item => new FileHistory(item));\n      this.filePath = addedHistoryVersions[dataCount - 1].path;\n      this.oldFilePath = addedHistoryVersions[dataCount - 1].revRenamedOldPath;\n      const historyVersions = [ ...this.state.historyVersions, ...addedHistoryVersions ];\n      this.setState({ historyVersions: historyVersions, isLoading: false, errorMessage: '' }, () => {\n        callback && callback(historyVersions[0], historyVersions[1]);\n      });\n      return;\n    }\n    if (this.nextCommit) {\n      this.listHistoryVersions(historyRepoID, filePath, this.nextCommit);\n      return;\n    }\n    this.hasMore = false;\n    this.setState({ isLoading: false, errorMessage: '' });\n  }\n\n  onScrollHandler = (event) => {\n    const clientHeight = event.target.clientHeight;\n    const scrollHeight = event.target.scrollHeight;\n    const scrollTop = event.target.scrollTop;\n    const isBottom = (clientHeight + scrollTop + 1 >= scrollHeight);\n    if (isBottom && this.hasMore && this.nextCommit) {\n      this.loadMore();\n    }\n  }\n\n  loadMore = () => {\n    if (this.state.isLoading) return;\n    this.setState({ isLoading: true }, () => {\n      const currentFilePath = this.oldFilePath || this.filePath;\n      this.listHistoryVersions(historyRepoID, currentFilePath, this.nextCommit);\n    });\n  }\n\n  restoreVersion = (historyVersion) => {\n    const { commitId, path } = historyVersion;\n    editUtilities.revertFile(path, commitId).then(res => {\n      if (res.data.success) {\n        this.init();\n        this.setState({ isLoading: true, historyVersions: [], errorMessage: '' } , () => {\n          this.listHistoryVersions(historyRepoID, filePath);\n        });\n      }\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      toaster.danger(gettext(errorMessage));\n    });\n  }\n\n  onSelectHistoryVersion = (historyVersion) => {\n    const { isShowChanges } = this.props;\n    if (!isShowChanges) {\n      this.props.onSelectHistoryVersion(historyVersion);\n      return;\n    }\n    const { historyVersions } = this.state;\n    const historyVersionIndex = historyVersions.findIndex(item => item.commitId === historyVersion.commitId);\n    this.props.onSelectHistoryVersion(historyVersion, historyVersions[historyVersionIndex + 1]);\n  }\n\n  renderHistoryVersions = () => {\n    const { isLoading, historyVersions, errorMessage } = this.state;\n    if (historyVersions.length === 0) {\n      if (isLoading) {\n        return (\n          <div className=\"h-100 w-100 d-flex align-items-center justify-content-center\">\n            <Loading />\n          </div>\n        );\n      }\n      if (errorMessage) {\n        return (\n          <div className=\"h-100 w-100 d-flex align-items-center justify-content-center error-message\">\n            {gettext(errorMessage)}\n          </div>\n        );\n      }\n      return (\n        <div className=\"h-100 w-100 d-flex align-items-center justify-content-center empty-tip-color\">\n          {gettext('No_historical_versions')}\n        </div>\n      );\n    }\n\n    return (\n      <>\n        {historyVersions.map((historyVersion, index) => {\n          return (\n            <HistoryVersion\n              key={historyVersion.commitId}\n              index={index}\n              currentVersion={this.props.currentVersion}\n              historyVersion={historyVersion}\n              onSelectHistoryVersion={this.onSelectHistoryVersion}\n              onRestore={this.restoreVersion}\n            />\n          );\n        })}\n        {isLoading && (\n          <div className=\"loading-more d-flex align-items-center justify-content-center w-100\">\n            <Loading />\n          </div>\n        )}\n      </>\n    );\n  }\n\n  onShowChanges = () => {\n    const { isShowChanges, currentVersion } = this.props;\n    const { historyVersions } = this.state;\n    const historyVersionIndex = historyVersions.findIndex(item => item.commitId === currentVersion.commitId);\n    const lastVersion = historyVersions[historyVersionIndex + 1];\n    this.props.onShowChanges(!isShowChanges, lastVersion);\n  }\n\n  render() {\n    const { historyVersions } = this.state;\n\n    return (\n      <div className=\"sdoc-file-history-panel h-100 o-hidden d-flex flex-column\">\n        <div className=\"sdoc-file-history-select-range\">\n          <div className=\"sdoc-file-history-select-range-title\">\n            {gettext('History Versions')}\n          </div>\n        </div>\n        <div\n          className={classnames('sdoc-file-history-versions', { 'o-hidden': historyVersions.length === 0 } )}\n          onScroll={this.onScrollHandler}\n        >\n          {this.renderHistoryVersions()}\n        </div>\n        <div className=\"sdoc-file-history-diff-switch d-flex align-items-center\">\n          <Switch\n            checked={this.props.isShowChanges}\n            placeholder={gettext('Show changes')}\n            className=\"sdoc-history-show-changes w-100\"\n            size=\"small\"\n            onChange={this.onShowChanges}\n          />\n        </div>\n      </div>\n    );\n  }\n}\n\nSidePanel.propTypes = {\n  isShowChanges: PropTypes.bool,\n  currentVersion: PropTypes.object,\n  onSelectHistoryVersion: PropTypes.func,\n  onShowChanges: PropTypes.func,\n};\n\nexport default SidePanel;\n","import React from 'react';\nimport ReactDom from 'react-dom';\nimport { UncontrolledTooltip } from 'reactstrap';\nimport classnames from 'classnames';\nimport { DiffViewer } from '@seafile/sdoc-editor';\nimport { seafileAPI } from '../../utils/seafile-api';\nimport { gettext, historyRepoID } from '../../utils/constants';\nimport Loading from '../../components/loading';\nimport GoBack from '../../components/common/go-back';\nimport SidePanel from './side-panel';\nimport { Utils } from '../../utils/utils';\nimport toaster from '../../components/toast';\n\nimport '../../css/layout.css';\nimport '../../css/sdoc-file-history.css';\n\nconst { serviceURL, avatarURL, siteRoot } = window.app.config;\nconst { username, name } = window.app.pageOptions;\nconst { repoID, fileName, filePath, docUuid, assetsUrl  } = window.fileHistory.pageOptions;\n\nwindow.seafile = {\n  repoID,\n  docPath: filePath,\n  docName: fileName,\n  docUuid,\n  isOpenSocket: false,\n  serviceUrl: serviceURL,\n  name,\n  username,\n  avatarURL,\n  siteRoot,\n  assetsUrl,\n};\n\nclass SdocFileHistory extends React.Component {\n\n  constructor(props) {\n    super(props);\n    const isShowChanges = localStorage.getItem('seahub-sdoc-history-show-changes') === 'false' ? false : true;\n    this.state = {\n      isLoading: true,\n      isShowChanges,\n      currentVersion: {},\n      currentVersionContent: '',\n      lastVersionContent: '',\n      changes: [],\n      currentDiffIndex: 0,\n    };\n  }\n\n  onSelectHistoryVersion = (currentVersion, lastVersion) => {\n    this.setState({ isLoading: true, currentVersion });\n    seafileAPI.getFileRevision(historyRepoID, currentVersion.commitId, currentVersion.path).then(res => {\n      return seafileAPI.getFileContent(res.data);\n    }).then(res => {\n      const currentVersionContent = res.data;\n      if (lastVersion) {\n        seafileAPI.getFileRevision(historyRepoID, lastVersion.commitId, lastVersion.path).then(res => {\n          return seafileAPI.getFileContent(res.data);\n        }).then(res => {\n          const lastVersionContent = res.data;\n          this.setContent(currentVersionContent, lastVersionContent);\n        }).catch(error => {\n          const errorMessage = Utils.getErrorMsg(error, true);\n          toaster.danger(gettext(errorMessage));\n          this.setContent(currentVersionContent, '');\n        });\n      } else {\n        this.setContent(currentVersionContent, '');\n      }\n    }).catch(error => {\n      const errorMessage = Utils.getErrorMsg(error, true);\n      toaster.danger(gettext(errorMessage));\n      this.setContent('', '');\n    });\n  }\n\n  setContent = (currentVersionContent = '', lastVersionContent = '') => {\n    this.setState({ currentVersionContent, lastVersionContent, isLoading: false, changes: [], currentDiffIndex: 0 });\n  }\n\n  onShowChanges = (isShowChanges, lastVersion) => {\n    if (isShowChanges && lastVersion) {\n      const { currentVersionContent } = this.state;\n      this.setState({ isLoading: true }, () => {\n        localStorage.setItem('seahub-sdoc-history-show-changes', isShowChanges + '');\n        seafileAPI.getFileRevision(historyRepoID, lastVersion.commitId, lastVersion.path).then(res => {\n          return seafileAPI.getFileContent(res.data);\n        }).then(res => {\n          const lastVersionContent = res.data;\n          this.setContent(currentVersionContent, lastVersionContent);\n          this.setState({ isShowChanges });\n        }).catch(error => {\n          const errorMessage = Utils.getErrorMsg(error, true);\n          toaster.danger(gettext(errorMessage));\n          this.setContent(currentVersionContent, '');\n          this.setState({ isShowChanges });\n        });\n      });\n      return;\n    }\n    this.setState({ isShowChanges }, () => {\n      localStorage.setItem('seahub-sdoc-history-show-changes', isShowChanges + '');\n    });\n  }\n\n  setDiffCount = (diff = { value: [], changes: [] }) => {\n    const { changes } = diff;\n    this.setState({ changes, currentDiffIndex: 0 });\n  }\n\n  jumpToElement = (currentDiffIndex) => {\n    this.setState({ currentDiffIndex }, () => {\n      const { currentDiffIndex, changes } = this.state;\n      const change = changes[currentDiffIndex];\n      const changeElement = document.querySelectorAll(`[data-id=${change}]`)[0];\n      if (changeElement) {\n        this.historyContentRef.scrollTop = changeElement.offsetTop - 10;\n      }\n    });\n  }\n\n  lastChange = () => {\n    const { currentDiffIndex, changes } = this.state;\n    if (currentDiffIndex === 0) {\n      this.jumpToElement(changes.length - 1);\n      return;\n    }\n    this.jumpToElement(currentDiffIndex - 1);\n  }\n\n  nextChange = () => {\n    const { currentDiffIndex, changes } = this.state;\n    if (currentDiffIndex === changes.length - 1) {\n      this.jumpToElement(0);\n      return;\n    }\n    this.jumpToElement(currentDiffIndex + 1);\n  }\n\n  render() {\n    const { currentVersion, isShowChanges, currentVersionContent, lastVersionContent, isLoading, changes, currentDiffIndex } = this.state;\n    const changesCount = changes ? changes.length : 0;\n    const isShowChangesTips = isShowChanges && changesCount > 0;\n\n    return (\n      <div className=\"sdoc-file-history d-flex h-100 w-100 o-hidden\">\n        <div className=\"sdoc-file-history-container d-flex flex-column\">\n          <div className=\"sdoc-file-history-header pt-2 pb-2 pl-4 pr-4 d-flex justify-content-between w-100 o-hidden\">\n            <div className={classnames('sdoc-file-history-header-left d-flex align-items-center o-hidden', { 'pr-4': isShowChangesTips })}>\n              <GoBack />\n              <div className=\"file-name text-truncate\">{fileName}</div>\n            </div>\n            {isShowChangesTips && (\n              <div className=\"sdoc-file-history-header-right d-flex align-items-center\">\n                <div className=\"sdoc-file-changes-container d-flex align-items-center \">\n                  <div className=\"sdoc-file-changes-tip d-flex align-items-center justify-content-center pl-2 pr-2\">\n                    {`${gettext('Changes')} ${currentDiffIndex + 1}/${changesCount}`}\n                  </div>\n                  <div className=\"sdoc-file-changes-divider\"></div>\n                  <div\n                    className=\"sdoc-file-changes-last d-flex align-items-center justify-content-center\"\n                    id=\"sdoc-file-changes-last\"\n                    onClick={this.lastChange}\n                  >\n                    <span className=\"fas fa-chevron-up\"></span>\n                  </div>\n                  <div className=\"sdoc-file-changes-divider\"></div>\n                  <div\n                    className=\"sdoc-file-changes-next d-flex align-items-center justify-content-center\"\n                    id=\"sdoc-file-changes-next\"\n                    onClick={this.nextChange}\n                  >\n                    <span className=\"fas fa-chevron-down\"></span>\n                  </div>\n                  <UncontrolledTooltip placement=\"bottom\" target=\"sdoc-file-changes-last\">\n                    {gettext('Last modification')}\n                  </UncontrolledTooltip>\n                  <UncontrolledTooltip placement=\"bottom\" target=\"sdoc-file-changes-next\">\n                    {gettext('Next modification')}\n                  </UncontrolledTooltip>\n                </div>\n              </div>\n            )}\n          </div>\n          <div className=\"sdoc-file-history-content f-flex flex-column\" ref={ref => this.historyContentRef = ref}>\n            {isLoading ? (\n              <div className=\"sdoc-file-history-viewer d-flex align-items-center justify-content-center\">\n                <Loading />\n              </div>\n            ) : (\n              <DiffViewer\n                currentContent={currentVersionContent}\n                lastContent={isShowChanges ? lastVersionContent : ''}\n                didMountCallback={this.setDiffCount}\n              />\n            )}\n          </div>\n        </div>\n        <SidePanel\n          isShowChanges={isShowChanges}\n          currentVersion={currentVersion}\n          onSelectHistoryVersion={this.onSelectHistoryVersion}\n          onShowChanges={this.onShowChanges}\n        />\n      </div>\n    );\n  }\n}\n\nReactDom.render(<SdocFileHistory />, document.getElementById('wrapper'));\n"],"sourceRoot":""}